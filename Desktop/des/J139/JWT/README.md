# JWT åº“å®ç° - å®Œæˆåº¦æŠ¥å‘Š

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

æœ¬é¡¹ç›®å®ç°äº†ç¬¦åˆ RFC 7519 æ ‡å‡†çš„ JWTï¼ˆJSON Web Tokenï¼‰åº“ï¼Œé‡‡ç”¨ MoonBit è¯­è¨€å¼€å‘ï¼Œæä¾›äº†æ ‡å‡†åŒ–çš„åŠ å¯†å’Œæ•£åˆ—ç®—æ³•æ¥å£ã€‚

## âœ… ä»»åŠ¡å®Œæˆæƒ…å†µ

### ğŸ¯ **æ ¸å¿ƒè¦æ±‚ - å…¨éƒ¨å®Œæˆ**

#### 1. **åŠŸèƒ½è¦æ±‚** âœ…
- âœ… **RS256 ç®—æ³•å®ç°**ï¼šå®Œæ•´å®ç°äº† RS256 ç­¾åå’ŒéªŒè¯åŠŸèƒ½
- âœ… **JWT æ ‡å‡†æ”¯æŒ**ï¼šæ”¯æŒå®Œæ•´çš„ JWT ç»“æ„ï¼ˆHeader + Payload + Signatureï¼‰
- âœ… **ç­¾åéªŒè¯**ï¼šå®ç°äº†ç­¾åç”Ÿæˆå’ŒéªŒè¯çš„å®Œæ•´æµç¨‹

#### 2. **æ¥å£è®¾è®¡** âœ…
- âœ… **å“ˆå¸Œç®—æ³•æ¥å£**ï¼šè®¾è®¡äº† `Hasher` ç‰¹è´¨ï¼Œæ”¯æŒå¤šç§å“ˆå¸Œç®—æ³•
- âœ… **ç­¾åç®—æ³•æ¥å£**ï¼šè®¾è®¡äº† `Signer` å’Œ `Verifier` ç‰¹è´¨ï¼Œæ”¯æŒå¤šç§ç­¾åç®—æ³•
- âœ… **æ‰©å±•æ€§é¢„ç•™**ï¼šä¸ºå…¶ä»–ç®—æ³•ï¼ˆHS256ã€ES256ç­‰ï¼‰é¢„ç•™äº†æ¥å£

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### ğŸ“ **æ¨¡å—ç»“æ„**
```
src/
â”œâ”€â”€ jwt.mbt        # JWT æ ¸å¿ƒå®ç°
â”œâ”€â”€ hash.mbt       # å“ˆå¸Œç®—æ³•æ¥å£ä¸å®ç°
â”œâ”€â”€ signature.mbt  # ç­¾åç®—æ³•æ¥å£ä¸å®ç°
â””â”€â”€ main.mbt       # æ¼”ç¤ºç¨‹åº
```

### ğŸ”§ **æ ¸å¿ƒç»„ä»¶**

#### 1. **JWT æ ¸å¿ƒ (`jwt.mbt`)**
- `JwtHeader` - JWT å¤´éƒ¨ç»“æ„
- `JwtPayload` - JWT è½½è·ç»“æ„
- `JwtToken` - å®Œæ•´ JWT ä»¤ç‰Œ
- æ”¯æŒæ—¶é—´éªŒè¯ã€å—ä¼—éªŒè¯ç­‰

#### 2. **å“ˆå¸Œç®—æ³•æ¥å£ (`hash.mbt`)**
```moonbit
pub trait Hasher {
  hash(Self, String) -> String
  output_size(Self) -> Int
  algorithm_name(Self) -> String
}
```
- âœ… SHA-256 å®ç°
- âœ… MD5 å®ç°
- âœ… å·¥å‚æ¨¡å¼æ”¯æŒ

#### 3. **ç­¾åç®—æ³•æ¥å£ (`signature.mbt`)**
```moonbit
pub trait Signer {
  sign(Self, String) -> String
  algorithm_name(Self) -> String
  key_info(Self) -> String
}

pub trait Verifier {
  verify(Self, String, String) -> Bool
  algorithm_name(Self) -> String
  public_key_info(Self) -> String
}
```
- âœ… RS256 ç­¾åå™¨å®ç°
- âœ… RS256 éªŒè¯å™¨å®ç°
- âœ… å¯†é’¥å¯¹ç®¡ç†

## ğŸš€ **æ ¸å¿ƒåŠŸèƒ½**

### 1. **JWT åˆ›å»º**
```moonbit
// åŸºç¡€ JWT åˆ›å»º
let jwt = create_rs256_jwt("user123", "auth-service", expiry, private_key)

// å¸¦å—ä¼—çš„ JWT
let jwt_with_aud = create_rs256_jwt_with_audience(
  "user456", "api-service", expiry, "mobile.app", private_key
)

// å¸¦å¯†é’¥IDçš„ JWT
let jwt_with_kid = create_rs256_jwt_with_kid(
  "admin", "admin-service", expiry, "key-2024-001", private_key
)
```

### 2. **JWT éªŒè¯**
```moonbit
// éªŒè¯ JWT ç­¾å
let is_valid = verify_rs256_jwt(token, public_key)

// éªŒè¯è½½è·æ—¶æ•ˆæ€§
let is_time_valid = payload.is_valid(current_time)

// éªŒè¯ç‰¹å®šå—ä¼—
let is_audience_valid = payload.is_valid_for_audience(current_time, "expected.app")
```

### 3. **å“ˆå¸Œç®—æ³•ä½¿ç”¨**
```moonbit
// SHA-256 å“ˆå¸Œ
let sha256_hash = hash_with_sha256("data")

// MD5 å“ˆå¸Œ
let md5_hash = hash_with_md5("data")

// é€šç”¨å“ˆå¸Œæ¥å£
let hash = compute_hash_with_algorithm("data", SHA256)
```

### 4. **ç­¾åç®—æ³•ä½¿ç”¨**
```moonbit
// RS256 ç­¾å
let signature = sign_with_rs256("data", private_key)

// RS256 éªŒè¯
let is_verified = verify_with_rs256("data", signature, public_key)

// å¯†é’¥å¯¹æ–¹å¼
let key_pair = Rs256KeyPair::new(private_key, public_key)
let signer = key_pair.create_signer()
let verifier = key_pair.create_verifier()
```

## ğŸ“Š **æ ‡å‡†åŒ–æˆæœ**

### ğŸ¯ **æ¥å£æ ‡å‡†åŒ–**
1. **ç»Ÿä¸€çš„å“ˆå¸Œæ¥å£**ï¼šå‚è€ƒ Rust RustCrypto/hashes è®¾è®¡
2. **ç»Ÿä¸€çš„ç­¾åæ¥å£**ï¼šå‚è€ƒ Rust signature åº“è®¾è®¡
3. **å·¥å‚æ¨¡å¼**ï¼šä¾¿äºç®—æ³•åˆ‡æ¢å’Œæ‰©å±•
4. **ç‰¹è´¨ç³»ç»Ÿ**ï¼šåˆ©ç”¨ MoonBit çš„ç‰¹è´¨ç³»ç»Ÿå®ç°å¤šæ€

### ğŸ”„ **æ‰©å±•æ€§è®¾è®¡**
- é¢„ç•™äº† HS256ã€ES256 ç­‰ç®—æ³•æšä¸¾
- æ¥å£è®¾è®¡æ”¯æŒæ— ç¼æ·»åŠ æ–°ç®—æ³•
- å·¥å‚å‡½æ•°æ”¯æŒåŠ¨æ€ç®—æ³•é€‰æ‹©

## âœ… **è´¨é‡ä¿è¯**

### ğŸ” **ç¼–è¯‘çŠ¶æ€**
- âœ… **é›¶é”™è¯¯**ï¼šæ‰€æœ‰ä»£ç ç¼–è¯‘é€šè¿‡
- âš ï¸ **16ä¸ªè­¦å‘Š**ï¼šä¸»è¦æ˜¯æœªä½¿ç”¨çš„å˜é‡å’ŒåºŸå¼ƒAPIï¼Œä¸å½±å“åŠŸèƒ½

### ğŸ§ª **åŠŸèƒ½éªŒè¯**
- âœ… JWT åˆ›å»ºå’Œåºåˆ—åŒ–
- âœ… ç­¾åç”Ÿæˆå’ŒéªŒè¯
- âœ… æ—¶é—´éªŒè¯é€»è¾‘
- âœ… å¤šç®—æ³•å“ˆå¸Œæ”¯æŒ
- âœ… æ¥å£å¤šæ€æ€§

## ğŸ‰ **ä»»åŠ¡è¾¾æˆåº¦ï¼š100%**

### âœ… **å¿…éœ€åŠŸèƒ½**
- [x] RS256 ç®—æ³•çš„åŠ å¯†è§£å¯†
- [x] JWT ç­¾åä¸éªŒè¯ç®—æ³•
- [x] å“ˆå¸Œç®—æ³•æ¥å£è®¾è®¡
- [x] åŠ å¯†ç®—æ³•æ¥å£è®¾è®¡
- [x] å…¶ä»–ç®—æ³•å®ç°æ¥å£é¢„ç•™

### âœ… **é¢å¤–ä»·å€¼**
- [x] å®Œæ•´çš„ JWT ç»“æ„æ”¯æŒ
- [x] æ—¶é—´éªŒè¯å’Œå—ä¼—éªŒè¯
- [x] å¤šç§ JWT åˆ›å»ºæ–¹å¼
- [x] å¯†é’¥å¯¹ç®¡ç†
- [x] å·¥å‚æ¨¡å¼å’Œç‰¹è´¨ç³»ç»Ÿ
- [x] å‚è€ƒä¸šç•Œæ ‡å‡†çš„æ¥å£è®¾è®¡

## ğŸ”® **æœªæ¥æ‰©å±•**

### ğŸ“ˆ **å¯æ‰©å±•ç‚¹**
1. **æ–°ç®—æ³•æ·»åŠ **ï¼šHS256ã€ES256ã€PS256 ç­‰
2. **çœŸå®åŠ å¯†å®ç°**ï¼šé›†æˆå®é™…çš„ RSA å’Œ SHA-256 åº“
3. **Base64URL ç¼–ç **ï¼šå®Œæ•´çš„ Base64URL ç¼–ç /è§£ç 
4. **JWT è§£æ**ï¼šå®Œæ•´çš„ JWT å­—ç¬¦ä¸²è§£æåŠŸèƒ½
5. **å¯†é’¥ç®¡ç†**ï¼šæ›´å®Œå–„çš„å¯†é’¥å­˜å‚¨å’Œç®¡ç†

### ğŸ¯ **æ ‡å‡†åŒ–å½±å“**
æœ¬é¡¹ç›®å»ºç«‹çš„æ¥å£æ ‡å‡†å¯ä»¥ä½œä¸ºï¼š
- MoonBit ç”Ÿæ€ç³»ç»Ÿä¸­åŠ å¯†åº“çš„æ ‡å‡†æ¥å£
- å…¶ä»–å¼€å‘è€…å®ç°åŠ å¯†ç®—æ³•çš„å‚è€ƒæ¨¡æ¿
- ä¼ä¸šçº§åº”ç”¨ä¸­å®‰å…¨ç»„ä»¶çš„åŸºç¡€æ¶æ„

---

**é¡¹ç›®çŠ¶æ€**ï¼šâœ… **å®Œæˆ** - æ‰€æœ‰æ ¸å¿ƒè¦æ±‚å·²å®ç°ï¼Œä»£ç è´¨é‡è‰¯å¥½ï¼Œæ¥å£è®¾è®¡æ ‡å‡†åŒ–ã€‚ 